---
title: "Assignment 1"
author: "Aleksandra Dacko"
date: "9/28/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(magrittr)
library(here)
```

```{r}
data<-read.csv(file="Data/ICAO_accidents.csv",header = T)
```

```{r}
head(data)
```
```{r}
#to limit ourselves 
#remove to specific information and duplicates
data %<>% mutate("AircraftType"=case_when(Airplane=="True"~"Airplane",
                                     Helicopter=="True"~"Helicopter"),
                "WeightCat"=case_when(Over5700=="True"~">5700",
                                        Over2250=="False" ~ "<2250",
                                        Over2250=="True" & Over5700=="False" ~"2250-5700")) %>%   select(!c("Location","Operator","Date","Model","StateOfOperator","Class","ScheduledCommercial","Official","OccCats","Over2250","Over5700","Helicopter","Airplane","Registration","X"))%>% 
  mutate_if(is.character, as.factor) 

str(data)



```

```{r}
#frequencies
data %$% table(AircraftType)

frq.per.country<-data %>% group_by(StateOfOccurrence) %>% 
  summarise(count=n()) %>% 
  arrange(count)

frq.per.FlightPhase<-data %>% group_by(FlightPhase) %>% 
  summarise(count=n()) %>% 
  arrange(count)

data %>% group_by(InjuryLevel) %>% 
  summarise(count=n()) %>% 
  arrange(count)

data %>% group_by(Risk) %>% 
  summarise(count=n()) %>% 
  arrange(count)

data %>% group_by(Risk) %>% 
  summarise(count=n()) %>% 
  arrange(count)



frq.flightPhase.by.InjuryLevel<-data %>% group_by(FlightPhase, InjuryLevel) %>% 
  summarise(count=n())

```

```{r}
#plots

# frequency of accidents by flight phase (Landing, Take-off, etc.) grouped by aircraft type (Airplane, Helicopter)
FlightPhase.order<-data %>% group_by(FlightPhase) %>% 
  summarise(count=n()) %>% 
  arrange(-count) %$% FlightPhase

ggplot(data = data, aes(x=factor(FlightPhase, FlightPhase.order), group=AircraftType)) + 
  geom_bar(mapping = aes(y=..prop..), stat="count") +
  coord_flip() +
  facet_wrap(~ AircraftType)+
  geom_text(aes(label = scales::percent(..prop..), y= ..prop..), stat= "count", size=3, hjust = -0.2 )  +
  scale_y_continuous(labels = scales::percent)+
  labs(x = "Flight Phase", y="Percentage")

#checks of hte numbers -- correct 
subset(data, AircraftType=="Airplane" & FlightPhase=="Take-off") %>% nrow / subset(data, AircraftType=="Airplane") %>% nrow
subset(data, AircraftType=="Helicopter" & FlightPhase=="Take-off") %>% nrow / subset(data, AircraftType=="Helicopter") %>% nrow

```
```{r}
# frequency of accidents in each flight pahse grouped by InjuryLevel
ggplot(data = data[data$InjuryLevel %in% c("Fatal", "Minor", "Serious", "None", "Unknown", ""),], aes(x=FlightPhase, group=InjuryLevel)) + 
  geom_bar(mapping = aes(y=..prop..), stat="count") +
  coord_flip() +
  facet_wrap(~ InjuryLevel)+
  geom_text(aes(label = scales::percent(..prop..), y= ..prop..), stat= "count", size=3, hjust = -0.2 )  +
  scale_y_continuous(labels = scales::percent)+
  labs(x = "Flight Phase", y="Percentage")

```

```{r}
ggplot(data = data, aes(x=FlightPhase, group=WeightCat)) + 
  geom_bar(mapping = aes(y=..prop..), stat="count") +
  coord_flip() +
  facet_wrap(~ WeightCat)+
  geom_text(aes(label = scales::percent(..prop..), y= ..prop..), stat= "count", size=3, hjust = -0.2 )  +
  scale_y_continuous(labels = scales::percent)+
  labs(x = "Flight Phase", y="Percentage")
```


```{r}

#number of accidents per year - trend
data %>% group_by(Year) %>% 
  summarise(count=n()) %>% 
  arrange(Year)%$%
  plot(Year, count, type="l")

ggplot(data = data, aes(x=Year)) + 
  geom_line(mapping = aes(y=..count..), stat="count") +
  labs(x = "Year", y="Count")

#there was a major drop in the number of accidents from 2012 onwards, so maybe split the data to before and after 2012 and investigate what else changed




```


