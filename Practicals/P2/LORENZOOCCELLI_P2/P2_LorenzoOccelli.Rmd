---
title: "Practical 2"
author: "Lorenzo Occelli"
date: "19-09-2022"
output:
  html_document:
    toc: yes
    toc_depth: 1
    toc_float: yes
    df_print: paged
    theme: paper
    highlight: pygments
    pandoc_args: --output=P2_LorenzoOccelli.html
  pdf_document:
    toc: yes
    toc_depth: '1'
fontsize: 12pt
urlcolor: blue
mainfont: Arial
editor_options: 
  chunk_output_type: inline
---

```{r import}
library(ISLR)
library(ggplot2)
library(tidyr)
library(tidyverse)
```

---
Show the basic R plotting functions
---

```{r 1}
data <- Hitters
```

```{r 2}
hist(data$Salary, xlab = "Salary in thousands of $")
```

```{r 3}
barplot(table(data$Years))
```

```{r 4}
plot(x = data$Hits, y = data$HmRun, xlab = "Hits", ylab = "Home runs")
```

```{r 5}
homeruns_plot <- 
  ggplot(data, aes(x= Hits, y = HmRun)) +
  geom_point() + 
  labs(x = "Hits", y = "Home runs")

homeruns_plot
```

```{r 6}
homeruns_plot +
  geom_density_2d() + 
  labs(title = "Cool density and scatter plot of baseball data") +
  theme_minimal()
```

---
1. __Name the aesthetics, geoms, scales, and facets of the above visualisation. Also name any statistical transformations or special coordinate systems.__
---

__Aesthetics__: \
  number of hits mapped to x-position \
  number of home runs mapped to y-position \
__Geoms__: points and contour lines \
__Scales__: \
  x-axis: continuous \
  y-axis: continuous \
__Facets__: None \
__Statistical transformations__: None \
__Special coordinate system__: cartesian \

---
2. __Run the code below to generate data. There will be three vectors in your environment. Put them in a data frame for entering it in a ggplot() call using either the data.frame() or the tibble() function. Give informative names and make sure the types are correct (use the as.<type>() functions). Name the result gg_students.__
---

```{r 7}
set.seed(1234)
student_grade  <- rnorm(32, 7)
student_number <- round(runif(32) * 2e6 + 5e6)
programme      <- sample(c("Science", "Social Science"), 32, replace = TRUE)
```

```{r 8}
gg_students <-
  tibble(
    ID = as.character(student_number),
    grade = student_grade,
    programme = as.factor(programme))

head(gg_students)
```

---
3. __Plot the first homeruns_plot again, but map the Hits to the y-axis and the HmRun to the x-axis instead.__
---

```{r 9}
homeruns_plot_rev <- 
  ggplot(data, aes(x= HmRun, y = Hits)) +
  geom_point() + 
  labs(x = "Home runs", y = "Hits")

homeruns_plot_rev
```

---
4. __Recreate the same plot once more, but now also map the variable League to the colour aesthetic and the variable Salary to the size aesthetic.__
---

```{r 10}
homeruns_plot_new <- 
  ggplot(data, aes(x= HmRun, y = Hits, colour = League, size = Salary)) +
  geom_point() + 
  labs(x = "Home runs", y = "Hits")

homeruns_plot_new
```

---
6. __Use geom_histogram() to create a histogram of the grades of the students in the gg_students dataset. Play around with the binwidth argument of the geom_histogram() function.__
---

```{r 11}
students_hist <- 
  ggplot(gg_students, aes(x = grade)) +
  geom_histogram(binwidth = 0.5)

students_hist
```

---
7. __Use geom_density() to create a density plot of the grades of the students in the gg_students dataset. Add the argument fill = "light seagreen" to geom_density().__
---

```{r 12}
students_density <-
  ggplot(gg_students, aes(x = grade)) +
  geom_density(fill = "light seagreen", alpha = 0.5)

students_density
```

---
8. __Add rug marks to the density plot through geom_rug(). You can edit the colour and size of the rug marks using those arguments within the geom_rug() function.__
---

```{r 13}
students_density +
  geom_rug(colour = "blue", alpha = 0.5, size = 1)
```

---
8. __Increase the data to ink ratio by removing the y axis label, setting the theme to theme_minimal(), and removing the border of the density polygon. Also set the limits of the x-axis to go from 0 to 10 using the xlim() function, because those are the plausible values for a student grade.__
---

```{r 14}
students_density2 <-
  ggplot(gg_students, aes(x = grade)) +
  geom_density(fill = "light seagreen", alpha = 0.5,
  linetype = 0) +
  geom_rug(colour = "blue", alpha = 0.5, size = 1) +
  labs(y = "") +
  theme_minimal() +
  xlim(0, 10)

students_density2
```
I could not find a better way to remove the border of the density polygon using the linetype = 0.

---
9. __Create a boxplot of student grades per programme in the gg_students dataset you made earlier: map the programme variable to the x position and the grade to the y position. For extra visual aid, you can additionally map the programme variable to the fill aesthetic.__
---

```{r 15}
gg_students %>% 
  ggplot(aes(x = programme, y = grade, fill = programme)) + 
  geom_boxplot()
```

---
10. __What do each of the horizontal lines in the boxplot mean? What do the vertical lines (whiskers) mean?__
---

The thick horizontal lines inside the boxes represent the 50th quartile, or median of our data. \
The lower and upper ends of the boxes are instead the first and the third quartile.\
The whiskers, to conclude, delimit the minimum and the maximum value of our set of data. We have to point out that they include only values no further than 1.5 * IQR from the hinge (where IQR is the inter-quartile range, or distance between the first and third quartiles). All values outside this range are classified as outliers, and are represented as single dots.

---
11. __Comparison of distributions across categories can also be done by adding a fill aesthetic to the density plot you made earlier. Try this out. To take care of the overlap, you might want to add some transparency in the geom_density() function using the alpha argument.__
---

```{r}
gg_students %>% 
  ggplot(aes(x = grade, fill = programme)) +
  geom_density(alpha = .5, colour = NA) +
  geom_rug(size = 1, colour = "light seagreen") +
  theme_minimal() +
  labs(y = "", fill = "Programme") +
  xlim(0, 10)
```

---
12. __Create a bar plot of the variable Years from the Hitters dataset.__
---

```{r}
data %>% 
  ggplot(aes(x=Years)) +
  geom_bar()
```

---
13. __Use geom_line() to make a line plot out of the first 200 observations of the variable Volume (the number of trades made on each day) of the Smarket dataset. You will need to create a Day variable using mutate() to map to the x-position. This variable can simply be the integers from 1 to 200. Remember, you can select the first 200 rows using Smarket[1:200, ].__
---

```{r}
Smarket[1:200,] %>% 
    mutate(Day = 1:200) %>% 
    ggplot(aes(x = Day, y = Volume)) +
    geom_line() +
    geom_point(size=2)
```

---
14. __Use the function which.max() to find out which of the first 200 days has the highest trade volume and use the function max() to find out how large this volume was.__
---

```{r}
which.max(Smarket[1:200,]$Volume)
max(Smarket[1:200,]$Volume)
```

---
15. __Use geom_label(aes(x = your_x, y = your_y, label = "Peak volume")) to add a label to this day. You can use either the values or call the functions. Place the label near the peak!__
---

```{r}
Smarket[1:200,] %>% 
    mutate(Day = 1:200) %>% 
    ggplot(aes(x = Day, y = Volume)) +
    geom_line() +
    geom_point(size=2) +
    geom_label(aes(x = 160, y = 2.5, label="Peak volume"))
```

---
16. __Create a data frame called baseball based on the Hitters dataset. In this data frame, create a factor variable which splits playersâ€™ salary range into 3 categories. Tip: use the filter() function to remove the missing values, and then use the cut() function and assign nice labels to the categories. In addition, create a variable which indicates the proportion of career hits that was a home run.__
---

```{r}
baseball <-
  Hitters %>% 
    filter(!is.na(Salary)) %>% 
    mutate(Salary_range = cut(Salary, breaks = 3, 
                       labels = c("Low salary", "Mid salary", "High salary")),
    Career_hmrun_proportion = CHmRun/CHits)
```

---
17. __Create a scatter plot where you map CWalks to the x position and the proportion you calculated in the previous exercise to the y position. Fix the y axis limits to (0, 0.4) and the x axis to (0, 1600) using ylim() and xlim(). Add nice x and y axis titles using the labs() function. Save the plot as the variable baseball_plot.__
---

```{r}
baseball_plot <-
baseball %>% 
  ggplot(aes(x = CWalks, y = Career_hmrun_proportion)) +
  geom_point() +
  ylim(0, 0.4) +
  xlim(0, 1600) +
  xlab("# walks during the carrer") +
  ylab("carrer hits/home run")
```

---
18. __Split up this plot into three parts based on the salary range variable you calculated. Use the facet_wrap() function for this; look at the examples in the help file for tips.__
---

```{r}
baseball_plot + facet_wrap(~Salary_range)
```

---
19. __Create an interesting data visualisation based on the Carseats data from the ISLR package.__
---
I want to see the correlation between the community income level of each location and price charged for each seats by the company

```{r}
Carseats_new <-
Carseats %>% 
  mutate(Income_level = cut(Income, breaks = 3, 
                       labels = c("Low income", "Medium income", "High income")))
Carseats_new %>% 
  ggplot(aes(x = Income, y = Sales, color = ShelveLoc))+
  geom_point() +
  xlab("community income level (thousands $)") +
  ylab("Price chargd $") +
  facet_wrap(~Income_level)
```

